<% if (protocol === 'https') { -%>
var HttpClient = require('https');
<% } else { -%>
var HttpClient = require('http');
<% } -%>

var REQUEST_OPTIONS = {
  host: "<%- host %>",
  port: <%- protocol === 'https' ? 443 : 80 %>,
  headers: <%- JSON.stringify(headers) %>
}

<% for (var i = 0; i < endpoints.length; ++i) {                     -%>
var <%- endpoints[i].functionName %> = function( 
<%   var addedOne = false                                           -%>
<%   for (var j = 0; j < endpoints[i].inputs.length; ++j) {         -%>
<%-    addedOne ? ', ' : ''                                         -%>
<%-    endpoints[i].inputs[j].name                                  -%>
<%     addedOne = true;                                             -%>
<%   }                                                              -%>
<%   addedOne ? ', callback' : 'callback'                           -%>
) { <%-%>
  var requestOptions = {
    host: '<%- host %>',
    port: <%- protocol === 'https' ? 443 : 80 %>,
    path: <%- endpoints[i].path %>,
    headers: <%- JSON.stringify(headers) %>,
    method: <%- endpoints[i].method %>,
  }

  var req = HttpClient.request(requestOptions, function(res) {
    res.setEncoding('utf8');
    var data = '';
    res.on('error', function(err) { callback(err); });
    res.on('data', function(dataIn) { data += dataIn });
    res.on('end', function() {
      data = JSON.stringify(data);
      output = {};
<%  for (var j = 0; j < endpoints[i].outputs.length; ++j) {      -%>
      output.<%- endpoints[i].outputs[j].name %> = data.<%- endpoints[i].outputs[j].name %>
<%  }                                                            -%>
      callback(null, output);
    })
  });
}
<% } -%>
